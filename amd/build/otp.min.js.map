{"version":3,"sources":["../src/otp.js"],"names":["define","$","Ajax","Notification","click","countrycode","html","fullphone","val","phone","test","timer","remaining","m","Math","floor","s","document","getElementById","innerHTML","timerOn","setTimeout","alert","removeAttr","removeClass","call","methodname","args","done","data","success","attr","addNotification","message","type","fail","exception","e","console","log"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @module     auth_otp/otp\n * @copyright  2021 Brain station 23 <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function ($, Ajax, Notification) {\n\n    $(\"#sendotp\").click(function () {\n        var countrycode =$('.iti__selected-dial-code').html();\n        var fullphone =  countrycode + $('#phone').val();\n        $('input[name=\"full_number\"]').val(fullphone);\n        var phone = $('#phone').val();\n        // ;\n        if (phone) {\n            var phoneno = /^\\d{10}$/;\n            if (phoneno.test(phone)) {\n                let timerOn = true;\n                function timer(remaining) {\n                    var m = Math.floor(remaining / 60);\n                    var s = remaining % 60;\n                    m = m < 10 ? '0' + m : m;\n                    s = s < 10 ? '0' + s : s;\n                    document.getElementById('timer').innerHTML = m + ':' + s;\n                    remaining -= 1;\n                    if (remaining >= 0 && timerOn) {\n                        setTimeout(function () {\n                            timer(remaining);\n                        }, 1000);\n                        return;\n                    }\n                    if (!timerOn) {\n                        // Do validate stuff here\n                        return;\n                    }\n                    // Do timeout stuff here\n                    alert('Timeout for otp');\n                    $('#sendotp').removeAttr('disabled');\n                    document.getElementById('timer').innerHTML = 'Resend Code';\n                    $('#sendotp').removeClass('d-none');\n                }\n                // API Call\n                var wsfunction = 'auth_otp_send_sms';\n                var params = {\n                    'phone': phone,\n                    'countrycode' : countrycode\n                };\n\n                var request = {\n                    methodname: wsfunction,\n                    args: params\n                };\n\n                try {\n                    Ajax.call([request])[0].done(function (data) {\n                        if (data.success == 1) {\n                            $('#otp-field').removeClass('d-none');\n                            $('#sendotp').attr('disabled', 'disabled');\n                            $('#phone').attr('disabled', 'disabled');\n                            $('#phone').val(phone);\n                            $('#username').val(phone);\n                            timer(300);\n\n                            Notification.addNotification({\n                                message: data.message,\n                                type: 'success'\n                            });\n\n                        } else {\n                            Notification.addNotification({\n                                message: 'Something went wrong to send otp Please Try again !!',\n                                type: 'error'\n                            });\n                        }\n                    }).fail(Notification.exception);\n                } catch (e) {\n                    console.log(e);\n                }\n            } else {\n                Notification.addNotification({\n                    message: 'insert Valid Phone number !!',\n                    type: 'error'\n                });\n            }\n        } else {\n            Notification.addNotification({\n                message: 'phone number can\\'t be empty',\n                type: 'error'\n            });\n\n        }\n        return false;\n    });\n});"],"file":"otp.min.js"}